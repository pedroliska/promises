<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link type="text/css" rel="Stylesheet" href="/resources/main.css" />
  <script src="resources/jquery.js"></script>
  <script>
    $(document).ready(function () {

      function jsonPromise(url) {
        return Promise.resolve($.ajax(url));
      }
      function chapterInfoToHtml(info) {
        return '<p><strong>' + info.title + '</strong> ' + info.content + '</p>';
      }

      jsonPromise('book.aspx').then(function (bookData) {

        $('#title').html(bookData.title);
        $('#author').html(bookData.author);


        var promises = bookData.chapterUrls.map(function (url) {
          return jsonPromise(url).then(function (chapterInfo) {
            $('#chapters').append(chapterInfoToHtml(chapterInfo));
          });
        });
        return Promise.all(promises);

      }).then(function () {
        $('#chapters').append('<p style="font-weight: bold">ALL DONE!</p>');
      });

    });
  </script>
</head>
<body>

  <h1 id="title"></h1>
  <p id="author"></p>
  <div id="chapters"></div>

</body>
</html>
