<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link type="text/css" rel="Stylesheet" href="/resources/main.css" />
  <script src="resources/jquery.js"></script>
  <script>
    $(document).ready(function () {

      function jsonPromise(url) {
        return Promise.resolve($.ajax(url));
      }

      jsonPromise('book.aspx').then(function (bookInfo) {

        var promises = bookInfo.chapterUrls.map(function (url) {
          return jsonPromise(url).then(function (chapterInfo) {
            var html = '<p><strong>' + chapterInfo.title + '</strong> ' + chapterInfo.content + '</p>';
            $('#chapters').append(html);
          });
        });
        return Promise.all(promises);

      }).then(function () {
        $('#chapters').append('<strong>ALL DONE!</strong>');
      });

    });
  </script>
</head>
<body>

  <h1 id="title"></h1>
  <div id="chapters"></div>

</body>
</html>
